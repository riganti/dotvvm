<Project ToolsVersion="15.0" Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFrameworks>$(DefaultTargetFrameworks)</TargetFrameworks>
    <AssemblyName>DotVVM.Samples.Common</AssemblyName>
  </PropertyGroup>
  <ItemGroup>
    <EmbeddedResource Include="compiler\resources\**\*" />
  </ItemGroup>
  <ItemGroup>
    <Content Include="**/*.dotmaster;**/*.dotcontrol;**/*.dothtml" Exclude="obj/**/*.*;bin/**/*.*" CopyToPublishDirectory="Always" />
  </ItemGroup>
  <ItemGroup>
    <Compile Remove="node_modules\**" />
    <Compile Remove="script\**" />
    <Content Remove="node_modules\**" />
    <Content Remove="script\**" />
    <EmbeddedResource Remove="node_modules\**" />
    <EmbeddedResource Remove="script\**" />
    <None Remove="node_modules\**" />
    <None Remove="script\**" />
  </ItemGroup>
  <ItemGroup>
    <Content Remove="Views\FeatureSamples\ViewModules\ModuleControl.dotcontrol" />
  </ItemGroup>
  <ItemGroup>
    <None Remove="sampleConfig.json" />
    <None Remove="tsconfig.react.json" />
    <None Remove="Scripts\ControlSamples_NamedCommand_ParameterStaticCommand.js" />
    <None Remove="Views\ComplexSamples\NestedComboBox\InnerWrapper.dotcontrol" />
    <None Remove="Views\ComplexSamples\NestedComboBox\OuterWrapper.dotcontrol" />
    <None Remove="Views\ComplexSamples\SPAErrorReporting\default.dothtml" />
    <None Remove="Views\ComplexSamples\SPAErrorReporting\site.dotmaster" />
    <None Remove="Views\ComplexSamples\SPAErrorReporting\test.dothtml" />
    <None Remove="Views\ComplexSamples\ViewModelPopulate\ViewModelPopulate.dothtml" />
    <None Remove="Views\ControlSamples\CheckBox\CheckBox_Objects.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\BindingCTValidation_StringToEnum.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\HeavilyNested.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_Complex_Error.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_Enum.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_Number.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_SelectedValue_ComplexToInt_Error.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_SelectedValue_StringToInt_Error.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_String.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\ItemBinding_ItemValueBinding_StringToObject.dothtml" />
    <None Remove="Views\ControlSamples\ComboBox\Nullable.dothtml" />
    <None Remove="Views\ControlSamples\GridView\GridViewCellDecorators.dothtml" />
    <None Remove="Views\ControlSamples\HierarchyRepeater\Basic.dothtml" />
    <None Remove="Views\ControlSamples\HierarchyRepeater\NodeControl.dotcontrol" />
    <None Remove="Views\ControlSamples\HierarchyRepeater\WithMarkupControl.dothtml" />
    <None Remove="Views\ControlSamples\Literal\Literal_NumberBinding.dothtml" />
    <None Remove="Views\ControlSamples\MultiSelect\binded.dothtml" />
    <None Remove="Views\ControlSamples\MultiSelect\hardcoded.dothtml" />
    <None Remove="Views\ControlSamples\NamedCommand\ParameterStaticCommandService.dothtml" />
    <None Remove="Views\ControlSamples\RadioButton\Nullable.dothtml" />
    <None Remove="Views\ControlSamples\RadioButton\RadioButton_Objects.dothtml" />
    <None Remove="Views\ControlSamples\Repeater\IndexInNestedRepeater.dothtml" />
    <None Remove="Views\ControlSamples\Repeater\NamedTemplate.dothtml" />
    <None Remove="Views\ControlSamples\RouteLink\RouteLinkQueryParameters.dothtml" />
    <None Remove="Views\ControlSamples\TemplateHost\Basic.dothtml" />
    <None Remove="Views\ControlSamples\TemplateHost\TemplatedListControl.dotcontrol" />
    <None Remove="Views\ControlSamples\TemplateHost\TemplatedMarkupControl.dotcontrol" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressQueues.dothtml" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressRedirect.dotmaster" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressRedirect1.dothtml" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressRedirect2.dothtml" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressRedirectSPA.dotmaster" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressRedirectSPA1.dothtml" />
    <None Remove="Views\ControlSamples\UpdateProgress\UpdateProgressRedirectSPA2.dothtml" />
    <None Remove="Views\ControlSamples\ValidationSummary\MessagesRendering.dothtml" />
    <None Remove="Views\ControlSamples\ValidationSummary\Performance.dothtml" />
    <None Remove="Views\Errors\CorruptedContentBetweenContentControls.dothtml" />
    <None Remove="Views\Errors\ExceptionInLifecycle.dothtml" />
    <None Remove="Views\Errors\ExceptionInRender.dothtml" />
    <None Remove="Views\Errors\InvalidServiceDirective.dothtml" />
    <None Remove="Views\Errors\InvalidLocationFallback.dothtml" />
    <None Remove="Views\Errors\ResourceCircularDependency.dothtml" />
    <None Remove="Views\FeatureSamples\Api\ApiInSpa_Master.dotmaster" />
    <None Remove="Views\FeatureSamples\Api\ApiInSpa_PageA.dothtml" />
    <None Remove="Views\FeatureSamples\Api\ApiInSpa_PageB.dothtml" />
    <None Remove="Views\FeatureSamples\Api\ApiRefresh.dothtml" />
    <None Remove="Views\FeatureSamples\Api\CollectionOddEvenWithRestApi.dothtml" />
    <None Remove="Views\FeatureSamples\Api\IncludedInPage.dothtml" />
    <None Remove="Views\FeatureSamples\Api\IsLoading.dothtml" />
    <None Remove="Views\FeatureSamples\Attribute\ToStringConversion.dothtml" />
    <None Remove="Views\FeatureSamples\AutoUI\AutoEditor.dothtml" />
    <None Remove="Views\FeatureSamples\AutoUI\AutoForm.dothtml" />
    <None Remove="Views\FeatureSamples\AutoUI\AutoGridViewColumns.dothtml" />
    <None Remove="Views\FeatureSamples\AutoUI\BootstrapForm3.dothtml" />
    <None Remove="Views\FeatureSamples\AutoUI\BootstrapForm4.dothtml" />
    <None Remove="Views\FeatureSamples\AutoUI\BootstrapForm5.dothtml" />
    <None Remove="Views\FeatureSamples\BindingVariables\StaticCommandVariablesWithService_Complex.dothtml" />
    <None Remove="Views\FeatureSamples\BindingVariables\StaticCommandVariablesWithService_Complex2.dothtml" />
    <None Remove="Views\FeatureSamples\BindingVariables\StaticCommandVariablesWithService_Simple.dothtml" />
    <None Remove="Views\FeatureSamples\Caching\CachedValues.dothtml" />
    <None Remove="Views\FeatureSamples\CompositeControls\ControlPropertyNamingConflict.dothtml" />
    <None Remove="Views\FeatureSamples\CommandActionFilter\CommandActionFilter.dothtml" />
    <None Remove="Views\FeatureSamples\HotReload\ViewChanges.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\ArrayTranslation.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\DateTimeTranslations.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\DictionaryIndexerTranslation.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\GenericMethodTranslation.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\ListIndexerTranslation.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\ListMethodTranslations.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\WebUtilityTranslations.dothtml" />
    <None Remove="Views\FeatureSamples\JavascriptTranslation\StringMethodTranslations.dothtml" />
    <None Remove="Views\FeatureSamples\JsComponentIntegration\ReactComponentIntegration.dothtml" />
    <None Remove="Views\FeatureSamples\JsDirectives\BasicSample.dothtml" />
    <None Remove="Views\FeatureSamples\LambdaExpressions\ClientSideFiltering.dothtml" />
    <None Remove="Views\FeatureSamples\LambdaExpressions\LambdaExpressions.dothtml" />
    <None Remove="Views\FeatureSamples\Localization\Globalize.dothtml" />
    <None Remove="Views\FeatureSamples\MarkupControl\MarkupDefinedProperties.dothtml" />
    <None Remove="Views\FeatureSamples\MarkupControl\MarkupDefinedPropertiesControl.dotcontrol" />
    <None Remove="Views\FeatureSamples\MarkupControl\ServiceDependency\ServiceDependencyControl.dotcontrol" />
    <None Remove="Views\FeatureSamples\PostbackAbortSignal\LoadAbortViewModel.dothtml" />
    <None Remove="Views\FeatureSamples\RenderSettingsModeServer\RepeaterCollectionSetToNull.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\ByteArray.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\DateOnlyTimeOnly.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\TimeSpan.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\EnumSerializationCoercion.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\SerializationDateTimeOffset.dothtml" />
    <None Remove="Views\FeatureSamples\StringInterpolation\StringInterpolation.dothtml" />
    <None Remove="Views\FeatureSamples\Validation\ValidationTargetIsCollection.dothtml" />
    <None Remove="Views\FeatureSamples\Validation\ValidatorValueComplexExpressions.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\Incrementer.dotcontrol" />
    <None Remove="Views\FeatureSamples\ViewModules\IncrementerInRepeater.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\InnerModuleControl.dotcontrol" />
    <None Remove="Views\FeatureSamples\ViewModules\LinkModuleControl.dotcontrol" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleControl.dotcontrol" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInMarkupControl.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInMarkupControlTwice.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInPage.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInPageCommandAmbiguous.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInPageMasterPage.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInPageSpaMasterPage.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleInPageSpaMasterPage2.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleMasterPage.dotmaster" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleRegistrationPropagation.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\ModuleSpaMasterPage.dotmaster" />
    <None Remove="Views\FeatureSamples\MarkupControl\CommandPropertiesInMarkupControl.dothtml" />
    <None Remove="Views\FeatureSamples\MarkupControl\Device.dotcontrol" />
    <None Remove="Views\FeatureSamples\MarkupControl\Dialog.dotcontrol" />
    <None Remove="Views\FeatureSamples\MarkupControl\StaticCommandInMarkupControl.dothtml" />
    <None Remove="Views\FeatureSamples\MarkupControl\StaticCommandInMarkupControlCallingRegularCommand.dothtml" />
    <None Remove="Views\FeatureSamples\PostbackConcurrency\RedirectPostbackQueue.dothtml" />
    <None Remove="Views\FeatureSamples\PostbackConcurrency\StressTest.dothtml" />
    <None Remove="Views\FeatureSamples\PostBack\RecursiveTextRepeater.dotcontrol" />
    <None Remove="Views\FeatureSamples\PostBack\RecursiveTextRepeater2.dotcontrol" />
    <None Remove="Views\FeatureSamples\PostBack\UniqueIdGenerationOnPostbackUpdate.dothtml" />
    <None Remove="Views\FeatureSamples\Redirect\Redirect_StaticCommand.dothtml" />
    <None Remove="Views\FeatureSamples\Resources\LocationFallback.dothtml" />
    <None Remove="Views\FeatureSamples\Resources\RequiredOnPostback.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\DeserializationVirtualElements.dothtml" />
    <None Remove="Views\FeatureSamples\CustomResponseProperties\SimpleExceptionFilter.dothtml" />
    <None Remove="Views\FeatureSamples\Serialization\Dictionary.dothtml" />
    <None Remove="Views\FeatureSamples\StaticCommand\CustomAwaitable.dothtml" />
    <None Remove="Views\FeatureSamples\StaticCommand\StaticCommand_ArrayAssigment.dothtml" />
    <None Remove="Views\FeatureSamples\StaticCommand\StaticCommand_LoadComplexDataFromService.dothtml" />
    <None Remove="Views\FeatureSamples\StaticCommand\StaticCommand_NullAssignment.dothtml" />
    <None Remove="Views\FeatureSamples\StaticCommand\StaticCommand_TaskSequence.dothtml" />
    <None Remove="Views\FeatureSamples\UsageValidation\OverrideValidation.dothtml" />
    <None Remove="Views\FeatureSamples\Validation\EnforceClientSideValidationDisabled.dothtml" />
    <None Remove="Views\FeatureSamples\Validation\InvalidCssClassNotDuplicated.dothtml" />
    <None Remove="Views\FeatureSamples\Validation\ValidationPropertyPathResolving.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModelCache\ViewModelCache_Miss.dothtml" />
    <None Remove="Views\FeatureSamples\ViewModules\OuterModuleControl.dotcontrol" />
  </ItemGroup>
  <ItemGroup>
    <Content Include="sampleConfig.json">
      <CopyToPublishDirectory>PreserveNewest</CopyToPublishDirectory>
    </Content>
    <Content Include="Scripts\ClientExtenders.js" />
    <Content Include="Scripts\ControlSamples_NamedCommand_ParameterStaticCommand.js" />
    <Content Include="Scripts\testResource.js" />
    <Content Include="Scripts\testResource2.js" />
    <Content Include="tsconfig.react.json" />
    <Content Include="tsconfig.json" />
  </ItemGroup>
  <ItemGroup Condition=" '$(TargetFramework)' == 'net472' ">
    <Reference Include="System" />
    <Reference Include="Microsoft.CSharp" />
    <Reference Include="System.ComponentModel.DataAnnotations" />
    <Reference Include="System.Net.Http" />
  </ItemGroup>
  <ItemGroup>
    <EmbeddedResource Include="Views\FeatureSamples\ViewModules\LinkModuleControl.dotcontrol" />
    <EmbeddedResource Include="Views\FeatureSamples\ViewModules\ModuleControl.dotcontrol" />
  </ItemGroup>
  <ItemGroup>
    <ProjectReference Include="../../Framework/Framework/DotVVM.Framework.csproj" />
    <ProjectReference Include="../Api.Common/DotVVM.Samples.BasicSamples.Api.Common.csproj" />
    <ProjectReference Include="../EmbeddedResourceControls/EmbeddedResourceControls.csproj" />
    <ProjectReference Include="../../AutoUI/Core/DotVVM.AutoUI.csproj" />
  </ItemGroup>
  <ItemGroup>
    <PackageReference Include="Microsoft.NETFramework.ReferenceAssemblies" Version="1.0.0">
      <PrivateAssets>all</PrivateAssets>
      <IncludeAssets>runtime; build; native; contentfiles; analyzers</IncludeAssets>
    </PackageReference>
  </ItemGroup>
  <ItemGroup>
    <Compile Update="Resources\DynamicDataTexts.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>DynamicDataTexts.resx</DependentUpon>
    </Compile>
    <Compile Update="Resources\Resource.Designer.cs">
      <DesignTime>True</DesignTime>
      <AutoGen>True</AutoGen>
      <DependentUpon>Resource.resx</DependentUpon>
    </Compile>
  </ItemGroup>
  <ItemGroup>
    <EmbeddedResource Update="Resources\DynamicDataTexts.resx">
      <Generator>ResXFileCodeGenerator</Generator>
      <LastGenOutput>DynamicDataTexts.Designer.cs</LastGenOutput>
    </EmbeddedResource>
    <EmbeddedResource Update="Resources\Resource.resx">
      <Generator>PublicResXFileCodeGenerator</Generator>
      <LastGenOutput>Resource.Designer.cs</LastGenOutput>
    </EmbeddedResource>
  </ItemGroup>
  <PropertyGroup Label="Configuration">
    <OutputPath>bin\Debug</OutputPath>
  </PropertyGroup>
  <PropertyGroup Condition="'$(Configuration)'=='Debug'">
    <DefineConstants>TRACE;DEBUG</DefineConstants>
  </PropertyGroup>
  
  <ItemGroup>
    <!-- the wildcard would not work in Target.Inputs, it only works in Include -->
    <TypescriptFile Include="Scripts/**/*.tsx;Scripts/**/*.ts" />
  </ItemGroup>
  
  <ItemGroup>
    <Folder Include="Properties\" />
  </ItemGroup>
  <!-- BeforeBuild is ran for every target framework. However, unless its input files change, this target is skipped. -->
  <Target Name="CompileJS" Inputs="@(TypescriptFile)" Outputs="script/react-app.js" BeforeTargets="DispatchToInnerBuilds;BeforeBuild">

    <PropertyGroup>
      <EnvOverrides>NO_COLOR=1;FORCE_COLOR=0;TERM=dumb</EnvOverrides>
    </PropertyGroup>

    <!-- Check if yarn exists, so we can fallback to npm otherwise -->
    <!-- Some Linux distros use yarnpkg as name for  -->
    <Exec Command="yarnpkg --version" IgnoreExitCode="True" ConsoleToMsBuild="True" ContinueOnError="true" EnvironmentVariables="$(EnvOverrides)">
      <Output TaskParameter="ExitCode" PropertyName="YarnVersionExitCode" />
    </Exec>

    <Exec Command="yarnpkg install --immutable" Condition="'$(YarnVersionExitCode)' == '0'" ContinueOnError="true" EnvironmentVariables="$(EnvOverrides)" />
    <Exec Command="npm ci" Condition="'$(YarnVersionExitCode)' != '0'" ContinueOnError="true" EnvironmentVariables="$(EnvOverrides)" />

    <Exec Command="yarnpkg build-production" Condition="'$(YarnVersionExitCode)' == '0'" ContinueOnError="true" YieldDuringToolExecution="True" ConsoleToMSBuild="true" EnvironmentVariables="$(EnvOverrides)" />
    <Exec Command="yarnpkg build-development" Condition="'$(YarnVersionExitCode)' == '0'" ContinueOnError="true" YieldDuringToolExecution="True" ConsoleToMSBuild="true" EnvironmentVariables="$(EnvOverrides)" />

    <Exec Command="npm run build-production" Condition="'$(YarnVersionExitCode)' != '0'" ContinueOnError="true" YieldDuringToolExecution="True" EnvironmentVariables="$(EnvOverrides)" />
    <Exec Command="npm run build-development" Condition="'$(YarnVersionExitCode)' != '0'" ContinueOnError="true" YieldDuringToolExecution="True" EnvironmentVariables="$(EnvOverrides)" />
  </Target>

</Project>
